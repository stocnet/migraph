<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>7. Testing • migraph</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="7. Testing">
<meta property="og:description" content="migraph">
<meta property="og:image" content="https://snlab-ch.github.io/migraph/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">migraph</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.12.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Function Overview</a>
</li>
<li>
  <a href="../articles/index.html">Practical Lessons</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/snlab-ch/migraph" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="p7linearmodel_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>7. Testing</h1>
                        <h4 data-toc-skip class="author">James Hollway</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/snlab-ch/migraph/blob/HEAD/vignettes/p7linearmodel.Rmd" class="external-link"><code>vignettes/p7linearmodel.Rmd</code></a></small>
      <div class="hidden name"><code>p7linearmodel.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="setting-up">Setting up<a class="anchor" aria-label="anchor" href="#setting-up"></a>
</h2>
<p>For this session, we’ll explore a couple of different datasets.</p>
<p>First, let’s examine homogeneity/heterogeneity in the Marvel relationships dataset. The dataset included in the package is quite complicated, so to make this simpler, let’s concentrate on:</p>
<ul>
<li>just the positive (friendship) ties and not the negative (enmity) ties</li>
<li>the main component without any isolates</li>
<li>just those characters that appear in the comics more than average</li>
</ul>
<p>Fortunately, all these data cleaning moves are easy to do in <a href="https://github.com/snlab-ch/migraph" class="external-link">migraph</a>, and can be seen in the following chunk in order:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/snlab-ch/migraph" class="external-link">migraph</a></span><span class="op">)</span></span>
<span><span class="va">marvel_friends</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reformat.html">to_unsigned</a></span><span class="op">(</span><span class="va">ison_marvel_relationships</span>, keep <span class="op">=</span> <span class="st">"positive"</span><span class="op">)</span></span>
<span><span class="va">marvel_friends</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transform.html">to_giant</a></span><span class="op">(</span><span class="va">marvel_friends</span><span class="op">)</span></span>
<span><span class="va">marvel_friends</span> <span class="op">&lt;-</span> <span class="va">marvel_friends</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/transform.html">to_subgraph</a></span><span class="op">(</span><span class="va">Appearances</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Appearances</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">marvel_friends</span></span>
<span><span class="co">#&gt; # A tbl_graph: 19 nodes and 107 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # An undirected simple graph with 1 component</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node Data: 19 × 10 (active)</span></span>
<span><span class="co">#&gt;   name  Gender Appear… Attrac…  Rich Intell… Omnili…</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Beast Male      7609       1     0       1       0</span></span>
<span><span class="co">#&gt; 2 Capt… Male      9000       1     0       1       0</span></span>
<span><span class="co">#&gt; 3 Colo… Male      5974       1     0       0       0</span></span>
<span><span class="co">#&gt; 4 Cycl… Male      8853       1     0       1       0</span></span>
<span><span class="co">#&gt; 5 Emma… Female    4777       1     0       0       1</span></span>
<span><span class="co">#&gt; 6 Hawk… Male      3982       1     0       0       0</span></span>
<span><span class="co">#&gt; # … with 13 more rows, and 3 more variables:</span></span>
<span><span class="co">#&gt; #   PowerOrigin &lt;chr&gt;, UnarmedCombat &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   ArmedCombat &lt;int&gt;</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge Data: 107 × 2</span></span>
<span><span class="co">#&gt;    from    to</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1     1     2</span></span>
<span><span class="co">#&gt; 2     1     3</span></span>
<span><span class="co">#&gt; 3     1     4</span></span>
<span><span class="co">#&gt; # … with 104 more rows</span></span></code></pre></div>
<p>This gives us a dataset of nearly twenty characters and a little more than 100 edges. Recall that this data has several nodal attributes. Let’s explore a couple of these attributes visually.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autographr.html">autographr</a></span><span class="op">(</span><span class="va">marvel_friends</span>, </span>
<span>           node_shape <span class="op">=</span> <span class="st">"Gender"</span>,</span>
<span>           node_color <span class="op">=</span> <span class="st">"PowerOrigin"</span><span class="op">)</span></span></code></pre></div>
<p><img src="teaching/unnamed-chunk-2-1.png"></p>
<p>These variables seem to be distributed unevenly across the network. There seems to be some homophily, or like choosing like, operating here, but it is difficult to tell because there are clearly more male than female superheros shown here, as well as clearly more superheros of mutant origin than others. To get started then, we need to establish how diverse this network is really.</p>
</div>
<div class="section level2">
<h2 id="calculating-diversity">Calculating diversity<a class="anchor" aria-label="anchor" href="#calculating-diversity"></a>
</h2>
<div class="section level3">
<h3 id="calculating-blau-index">Calculating Blau index<a class="anchor" aria-label="anchor" href="#calculating-blau-index"></a>
</h3>
<p>We can begin by calculating the Blau diversity for each attribute. Recall that the Blau index for any given diversity variable is:</p>
<p><span class="math display">\[1 - \sum p_i^2\]</span></p>
<p>where <span class="math inline">\(p\)</span> represents the proportion belonging to any given category, and <span class="math inline">\(i\)</span> indexes each of the given categories. As such a perfectly homogeneous group would receive a score of 0, while a perfectly heterogeneous group (with members spread evenly over the maximum categories) would receive a score of 1.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/diversity.html">network_diversity</a></span><span class="op">(</span><span class="va">marvel_friends</span>, <span class="st">"Gender"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.388</span></span>
<span><span class="fu"><a href="../reference/diversity.html">network_diversity</a></span><span class="op">(</span><span class="va">marvel_friends</span>, <span class="st">"PowerOrigin"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.593</span></span>
<span><span class="fu"><a href="../reference/diversity.html">network_diversity</a></span><span class="op">(</span><span class="va">marvel_friends</span>, <span class="st">"Attractive"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.188</span></span>
<span><span class="fu"><a href="../reference/diversity.html">network_diversity</a></span><span class="op">(</span><span class="va">marvel_friends</span>, <span class="st">"Rich"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.188</span></span>
<span><span class="fu"><a href="../reference/diversity.html">network_diversity</a></span><span class="op">(</span><span class="va">marvel_friends</span>, <span class="st">"Intellect"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.465</span></span></code></pre></div>
<p>Looks like there is more diversity in terms of where these characters got their powers, whether they have significant intellectual powers, and their gender, than their attractiveness or their wealth.</p>
<p>We can also cross-reference this diversity. For example, we might be interested in whether our comic book heroes are equally gender diverse across their (power) origin stories, or equally intellectually diverse across gender.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/diversity.html">network_diversity</a></span><span class="op">(</span><span class="va">marvel_friends</span>, <span class="st">"Gender"</span>, <span class="st">"PowerOrigin"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.000 0.000 0.463 0.375</span></span>
<span><span class="fu"><a href="../reference/diversity.html">network_diversity</a></span><span class="op">(</span><span class="va">marvel_friends</span>, <span class="st">"Intellect"</span>, <span class="st">"Gender"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.480 0.459</span></span></code></pre></div>
<p>Note that the length of the vector returned as a result is the number of categories in the second category listed. It looks like some origin stories are much more diverse than others. Gods (just Thor here) and humans are all men, whereas those with mutant or radiation origin stories are more gender diverse. There doesn’t seem to be any significant difference in intellect across gender categories however. We can visualise this quite effectively using the <code>node_groups</code> argument:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autographr.html">autographr</a></span><span class="op">(</span><span class="va">marvel_friends</span>, </span>
<span>           node_group <span class="op">=</span> <span class="st">"PowerOrigin"</span>, </span>
<span>           node_color <span class="op">=</span> <span class="st">"Gender"</span><span class="op">)</span></span></code></pre></div>
<p><img src="teaching/blaugroups-1.png"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/autographr.html">autographr</a></span><span class="op">(</span><span class="va">marvel_friends</span>, </span>
<span>           node_color <span class="op">=</span> <span class="st">"Gender"</span>, </span>
<span>           node_size <span class="op">=</span> <span class="st">"Intellect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="teaching/blaugroups-2.png"></p>
<p>Ok, this tells us about how (un)even the distribution of these variables is in this network, but it doesn’t necessarily tell us whether within this network there is homophily/heterophily.</p>
</div>
<div class="section level3">
<h3 id="calculating-ei-index">Calculating EI index<a class="anchor" aria-label="anchor" href="#calculating-ei-index"></a>
</h3>
<p>A step in this direction is to calculate the EI (or E-I) index. Calculating the EI index follows the same syntax. Recall that the EI index is calculated as:</p>
<p><span class="math display">\[\frac{E-I}{E+I}\]</span></p>
<p>where <span class="math inline">\(E\)</span> is the number of ties present between a variable’s categories (i.e. external), and <span class="math inline">\(I\)</span> is the number of ties present within a variable’s categories (i.e. internal). As such, an EI index of -1 suggests perfect homophily, whereas an EI index of +1 suggests perfect heterophily.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">obs.gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diversity.html">network_homophily</a></span><span class="op">(</span><span class="va">marvel_friends</span>, <span class="st">"Gender"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.196</span></span>
<span><span class="op">(</span><span class="va">obs.powers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diversity.html">network_homophily</a></span><span class="op">(</span><span class="va">marvel_friends</span>, <span class="st">"PowerOrigin"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] -0.00935</span></span>
<span><span class="op">(</span><span class="va">obs.attract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diversity.html">network_homophily</a></span><span class="op">(</span><span class="va">marvel_friends</span>, <span class="st">"Attractive"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] -0.645</span></span></code></pre></div>
<p>Looks like there might be some gender homophily present, but the score for power origin homophily is so close to 0 that it does not seem to signal much. There seems to be a fairly large effect for homophily on the basis of looks though…</p>
<p>Ultimately though, these are just scores, and doesn’t tell us whether this is any more or less than what we might expect the score to be by chance for a network of this size and density and distribution of that attribute.</p>
</div>
</div>
<div class="section level2">
<h2 id="testing-scores">Testing scores<a class="anchor" aria-label="anchor" href="#testing-scores"></a>
</h2>
<div class="section level3">
<h3 id="conditional-uniform-graph-tests">Conditional uniform graph tests<a class="anchor" aria-label="anchor" href="#conditional-uniform-graph-tests"></a>
</h3>
<p>To see whether we should be surprised by a score this high/low, we will simulate a series of random graphs (Erdös-Renyi/Bernoulli) of the same dimensions and distribution of the attribute to find out whether there is more homophily or heterophily than expected by chance.</p>
<p>This is called a conditional uniform graph test, but <a href="https://github.com/snlab-ch/migraph" class="external-link">migraph</a> chooses more descriptive function names, such as <code><a href="../reference/tests.html">test_random()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rand.gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tests.html">test_random</a></span><span class="op">(</span><span class="va">marvel_friends</span>, </span>
<span>                            <span class="va">network_homophily</span>, attribute <span class="op">=</span> <span class="st">"Gender"</span>, </span>
<span>                           times <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">rand.power</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tests.html">test_random</a></span><span class="op">(</span><span class="va">marvel_friends</span>, </span>
<span>                           <span class="va">network_homophily</span>, attribute <span class="op">=</span> <span class="st">"PowerOrigin"</span>, </span>
<span>                           times <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">rand.attract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tests.html">test_random</a></span><span class="op">(</span><span class="va">marvel_friends</span>, </span>
<span>                             <span class="va">network_homophily</span>, attribute <span class="op">=</span> <span class="st">"Attractive"</span>, </span>
<span>                           times <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rand.gender</span><span class="op">)</span> <span class="op">/</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rand.power</span><span class="op">)</span> <span class="op">/</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rand.attract</span><span class="op">)</span></span></code></pre></div>
<p><img src="teaching/rando-1.png"></p>
<p>The plots of these results use a dotted vertical line for 0 where this is in bounds, a red vertical line for the observed score, and a density plot of the scores from the randomly generated networks. The grey tails of the distribution are a visual aid indicating the most extreme 5% of scores from the distribution.</p>
<p>The results are <em>really</em> interesting. Despite being the larger coefficients (in absolute terms), it looks like we cannot reject the null hypothesis that there is no homophily for gender nor for attractiveness. Both observed scores fall within the range of scores we would expect from randomly generated networks with the same distribution of that variable.</p>
<p>However, we can reject the null hypothesis with respect to their power origin story. While the coefficient itself is close to 0 (neither strong homophily nor heterophily), all the random networks generated returned larger EI scores, between .1 and .4. That is, there is significantly less heterophily here than expected.</p>
</div>
<div class="section level3">
<h3 id="quadratic-assignment-procedure-tests">Quadratic assignment procedure tests<a class="anchor" aria-label="anchor" href="#quadratic-assignment-procedure-tests"></a>
</h3>
<p>Ah, but perhaps the random graph is not the best reference group for establishing whether there is a significant homophily effect here. After all, social networks are not completely random; they are structured.</p>
<p>Another approach is to use permutations of the network. Permuting the network retains the structure of the network, but reassigns any labels (variables) randomly. Let’s first plot the observed data and some permuted data next to each other.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autographr.html">autographr</a></span><span class="op">(</span><span class="va">marvel_friends</span>, </span>
<span>                  labels <span class="op">=</span> <span class="cn">FALSE</span>, node_size <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                  node_color <span class="op">=</span> <span class="st">"PowerOrigin"</span>, </span>
<span>                  node_shape <span class="op">=</span> <span class="st">"Gender"</span><span class="op">)</span></span>
<span><span class="va">new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autographr.html">autographr</a></span><span class="op">(</span><span class="fu"><a href="../reference/generate.html">generate_permutation</a></span><span class="op">(</span><span class="va">marvel_friends</span>, with_attr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   labels <span class="op">=</span> <span class="cn">FALSE</span>, node_size <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                  node_color <span class="op">=</span> <span class="st">"PowerOrigin"</span>,</span>
<span>                  node_shape <span class="op">=</span> <span class="st">"Gender"</span><span class="op">)</span></span>
<span><span class="va">old</span> <span class="op">+</span> <span class="va">new</span></span></code></pre></div>
<p><img src="teaching/perm-1.png"></p>
<p>This single permutation suggests there might otherwise be some more even mixing of these attributes, but it is just a single permutation. Let’s try a test that runs this over a succession of permutations, just as we did with random graphs.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perm.gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tests.html">test_permutation</a></span><span class="op">(</span><span class="va">marvel_friends</span>, </span>
<span>                                <span class="va">network_homophily</span>, attribute <span class="op">=</span> <span class="st">"Gender"</span>,</span>
<span>                                times <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">perm.power</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tests.html">test_permutation</a></span><span class="op">(</span><span class="va">marvel_friends</span>, </span>
<span>                               <span class="va">network_homophily</span>, attribute <span class="op">=</span> <span class="st">"PowerOrigin"</span>,</span>
<span>                                times <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p>Again, we see that there is perhaps nothing so surprising that we got the homophily score for gender that we did, but the lack of power origin heterophily is surprising.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rand.gender</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rand.power</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">perm.gender</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">perm.power</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="teaching/cugqap-1.png"></p>
<p>Note how the distributions are generally wider when permuting the observed network than creating a random distribution (be mindful of the scale of the <em>x</em>-axis). That is, taking into account the structure of the network leads us to expect a larger spread in the EI index than when the variable is distributed around a random network.</p>
</div>
</div>
<div class="section level2">
<h2 id="network-linear-models">Network linear models<a class="anchor" aria-label="anchor" href="#network-linear-models"></a>
</h2>
<p>Next let us examine homophily in another network. The data were collected as part of an early experiment on communication between social network researchers who were using an Electronic Information Exchange System (EIES). You may recognise some of the names. The main network consists of 32 scholars with directed ties weighted by the total number of messages sent from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span> over the period of the study. Nodal attributes collected include the primary discipline and number of citations in the social science citation index at the start of the study.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ison_networkers</span></span>
<span><span class="co">#&gt; # A tbl_graph: 32 nodes and 440 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A directed simple graph with 1 component</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Node Data: 32 × 3 (active)</span></span>
<span><span class="co">#&gt;   name               Discipline   Citations</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;              &lt;chr&gt;            &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 LIN FREEMAN        Sociology           19</span></span>
<span><span class="co">#&gt; 2 DOUG WHITE         Anthropology         3</span></span>
<span><span class="co">#&gt; 3 EV ROGERS          Other              170</span></span>
<span><span class="co">#&gt; 4 RICHARD ALBA       Sociology           23</span></span>
<span><span class="co">#&gt; 5 PHIPPS ARABIE      Other               16</span></span>
<span><span class="co">#&gt; 6 CAROL BARNER-BARRY Other                6</span></span>
<span><span class="co">#&gt; # … with 26 more rows</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # Edge Data: 440 × 3</span></span>
<span><span class="co">#&gt;    from    to weight</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     2    488</span></span>
<span><span class="co">#&gt; 2     1     3     28</span></span>
<span><span class="co">#&gt; 3     1     4     65</span></span>
<span><span class="co">#&gt; # … with 437 more rows</span></span>
<span><span class="fu"><a href="../reference/autographr.html">autographr</a></span><span class="op">(</span><span class="va">ison_networkers</span>,</span>
<span>           node_color <span class="op">=</span> <span class="st">"Discipline"</span><span class="op">)</span></span></code></pre></div>
<p><img src="teaching/intro-eies-1.png"></p>
<p>Let’s use both the continuous <code>Citations</code> and the categorical <code>Discipline</code> variables and come up with a couple of key hypotheses:</p>
<ul>
<li>
<span class="math inline">\(H_1\)</span>: whether these researchers send more emails to those who are cited more</li>
<li>
<span class="math inline">\(H_2\)</span>: whether there is disciplinary homophily</li>
</ul>
<p>Let’s start with a pretty maximally specified model (note that it doesn’t make sense to include both ego and alter effects because these are undirected):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regression.html">network_reg</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fu">alter</span><span class="op">(</span><span class="va">Citations</span><span class="op">)</span> <span class="op">+</span> <span class="fu">sim</span><span class="op">(</span><span class="va">Citations</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                      <span class="fu">alter</span><span class="op">(</span><span class="va">Discipline</span><span class="op">)</span> <span class="op">+</span> <span class="fu">same</span><span class="op">(</span><span class="va">Discipline</span><span class="op">)</span>, </span>
<span>                      <span class="va">ison_networkers</span>, times <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
<p>We can use tidy methods to get the salient information from this model, and <a href="https://github.com/snlab-ch/migraph" class="external-link">migraph</a> includes also a plot method for these results to facilitate the quick interpretation of these results.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 4</span></span>
<span><span class="co">#&gt;   term                       estimate stati…¹ p.value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 (intercept)                  1.72     0.194   0.94 </span></span>
<span><span class="co">#&gt; 2 alter Citations             -0.0326  -0.588   0.625</span></span>
<span><span class="co">#&gt; 3 sim Citations               24.4      2.86    0.215</span></span>
<span><span class="co">#&gt; 4 alter Discipline Mathemat… -16.8     -3.07    0.265</span></span>
<span><span class="co">#&gt; 5 alter Discipline Other     -10.6     -2.31    0.475</span></span>
<span><span class="co">#&gt; 6 alter Discipline Sociology  -7.37    -1.90    0.495</span></span>
<span><span class="co">#&gt; 7 same Discipline              3.90     1.23    0.41 </span></span>
<span><span class="co">#&gt; # … with abbreviated variable name ¹​statistic</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 8</span></span>
<span><span class="co">#&gt;   r.squ…¹ adj.r…² sigma stati…³ p.value    df df.re…⁴</span></span>
<span><span class="co">#&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  0.0334  0.0275  43.1    5.67 8.33e-6     6     985</span></span>
<span><span class="co">#&gt; # … with 1 more variable: nobs &lt;int&gt;, and</span></span>
<span><span class="co">#&gt; #   abbreviated variable names ¹​r.squared,</span></span>
<span><span class="co">#&gt; #   ²​adj.r.squared, ³​statistic, ⁴​df.residual</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></span></code></pre></div>
<p><img src="teaching/qap-interp-1.png"></p>
<p>This voilin plot presents the distribution of coefficients from permutations of the network, with the fitted coefficient from the data as a red dot. Subtle lines are used to indicate 95%, but here the distributions are rendered so wide that they are often not seen.</p>
<p>Hmm, looks like we can’t say much from this fit: the fitted coefficients are, if not typical, at least unsurprising from permutations of the network and so there’s no evidence for rejecting our hypotheses in this data.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Note that this works for calculated categorical variables too, such as cluster/group assignment from community detection or equivalence classes.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://jameshollway.com" class="external-link">James Hollway</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
